<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gantt Project Manager</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<!-- ==================== DASHBOARD VIEW ==================== -->
<div id="dashboard-view">
    <div class="toolbar">
        <span class="toolbar-brand">Gantt PM</span>
        <div class="toolbar-separator"></div>
        <div style="flex:1"></div>
        <button class="btn" onclick="openGlobalGantt()" title="Vista Portfolio">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="4" rx="1"/><rect x="3" y="10" width="18" height="4" rx="1"/><rect x="3" y="17" width="18" height="4" rx="1"/></svg>
            Portfolio
        </button>
        <button class="btn" onclick="showGlobalSettings()" title="Impostazioni">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        </button>
    </div>

    <div id="workspace-status"></div>
    <div class="dashboard-content">
        <div class="dashboard-header">
            <h2>I miei Progetti</h2>
            <div class="dashboard-controls">
                <div class="dashboard-search">
                    <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    <input type="text" id="dashboard-search-input" placeholder="Cerca..." oninput="dashboardSearch(this.value)" class="form-input" />
                </div>
                <select id="dashboard-sort-select" onchange="dashboardSort(this.value)" class="form-input">
                    <option value="lastSaved">Ultimo aggiornamento</option>
                    <option value="nameAsc">Nome A-Z</option>
                    <option value="nameDesc">Nome Z-A</option>
                    <option value="startDate">Data inizio</option>
                </select>
                <select id="dashboard-client-filter" onchange="dashboardClientFilterChange(this.value)" class="form-input">
                    <option value="">Tutti i clienti</option>
                </select>
                <div class="view-toggle">
                    <button class="view-toggle-btn active" id="view-toggle-grid" onclick="setDashboardView('grid')" title="Vista griglia">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                    </button>
                    <button class="view-toggle-btn" id="view-toggle-list" onclick="setDashboardView('list')" title="Vista lista">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
                    </button>
                </div>
            </div>
            <div class="dashboard-actions">
                <button class="btn btn-primary" onclick="showNewProjectModal()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    Nuovo Progetto
                </button>
            </div>
        </div>

        <div id="project-grid"></div>
    </div>
</div>

<!-- ==================== GANTT VIEW ==================== -->
<div id="gantt-view" style="display:none;">
    <div class="toolbar">
        <button class="btn" onclick="backToDashboard()" title="Torna alla dashboard">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
        </button>
        <span class="toolbar-brand">Gantt PM</span>
        <div class="toolbar-separator"></div>
        <span class="toolbar-title" id="gantt-project-title" onclick="showProjectOptions()" title="Opzioni progetto"></span>
        <div class="toolbar-separator"></div>

        <!-- Undo/Redo -->
        <button class="btn" id="btn-undo" onclick="undoAction()" title="Annulla (Ctrl+Z)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 4v6h6"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>
        </button>
        <button class="btn" id="btn-redo" onclick="redoAction()" title="Ripristina (Ctrl+Y)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6"/><path d="M20.49 15a9 9 0 1 1-2.13-9.36L23 10"/></svg>
        </button>
        <div class="toolbar-separator"></div>

        <!-- Export -->
        <button class="btn" onclick="exportSVG()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            SVG
        </button>
        <button class="btn" onclick="exportPNG()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            PNG
        </button>

        <div class="toolbar-separator"></div>
        <button class="btn" onclick="showProjectOptions()" title="Opzioni progetto">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/></svg>
            Opzioni
        </button>
    </div>

    <!-- Gantt Body: tools panel + chart -->
    <div class="gantt-body">
        <div id="tools-panel">
            <div class="tools-panel-header">
                <span class="tools-panel-title">Strumenti</span>
                <button class="btn-icon" id="tools-panel-toggle" onclick="toggleToolsPanel()" title="Comprimi pannello">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                </button>
            </div>
            <div class="tools-panel-body">
                <button class="tools-btn" onclick="showNewPhaseModal()" title="Nuova Fase">
                    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    <span>Nuova Fase</span>
                </button>
                <button class="tools-btn" onclick="showNewActivityModal()" title="Nuova Attività">
                    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    <span>Nuova Attività</span>
                </button>
                <button class="tools-btn" onclick="showNewMilestoneModal()" title="Nuova Milestone">
                    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    <span>Nuova Milestone</span>
                </button>
                <div class="tools-separator"></div>
                <button class="tools-btn" id="btn-toggle-deps" onclick="toggleDepsPanel()" title="Gestisci dipendenze">
                    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
                    <span>Dipendenze</span>
                </button>
                <div class="tools-separator"></div>
                <button class="tools-btn" onclick="toggleVersionsPanel()" title="Versioni e snapshot">
                    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="12 8 12 12 14 14"/><circle cx="12" cy="12" r="10"/></svg>
                    <span>Versioni</span>
                </button>
                <button class="tools-btn" onclick="showTodaySettingModal()" id="btn-today-setting" title="Imposta data di riferimento">
                    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    <span>Oggi</span>
                </button>
            </div>
            <div class="tools-zoom-group">
                <span class="tools-zoom-label">Zoom</span>
                <div class="tools-zoom-buttons">
                    <button class="tools-zoom-btn" id="zoom-week" onclick="setTimelineZoom('week')">Sett</button>
                    <button class="tools-zoom-btn active" id="zoom-month" onclick="setTimelineZoom('month')">Mese</button>
                    <button class="tools-zoom-btn" id="zoom-quarter" onclick="setTimelineZoom('quarter')">Trim</button>
                </div>
            </div>
        </div>
        <div id="gantt-svg-container"></div>
    </div>
</div>

<!-- ==================== GLOBAL GANTT VIEW (PORTFOLIO) ==================== -->
<div id="global-gantt-view" style="display:none;">
    <div class="toolbar">
        <button class="btn" onclick="backToDashboardFromGlobal()" title="Torna alla dashboard">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
        </button>
        <span class="toolbar-brand">Gantt PM</span>
        <div class="toolbar-separator"></div>
        <span class="toolbar-title">Portfolio</span>
        <div class="toolbar-separator"></div>

        <button class="btn" id="global-toggle-expand" onclick="toggleGlobalGanttExpanded()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg>
            <span id="global-expand-label">Espandi</span>
        </button>
        <div class="toolbar-separator"></div>

        <div class="tools-zoom-buttons" style="display:flex; gap:2px;">
            <button class="tools-zoom-btn" id="global-zoom-week" onclick="setGlobalTimelineZoom('week')">Sett</button>
            <button class="tools-zoom-btn active" id="global-zoom-month" onclick="setGlobalTimelineZoom('month')">Mese</button>
            <button class="tools-zoom-btn" id="global-zoom-quarter" onclick="setGlobalTimelineZoom('quarter')">Trim</button>
        </div>
        <div class="toolbar-separator"></div>

        <button class="btn" onclick="exportGlobalSVG()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            SVG
        </button>
        <button class="btn" onclick="exportGlobalPNG()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            PNG
        </button>

        <div style="flex:1"></div>
    </div>
    <div id="global-gantt-svg-container"></div>
</div>

<!-- ==================== VERSIONS PANEL ==================== -->
<div id="versions-backdrop" onclick="toggleVersionsPanel()"></div>
<div id="versions-panel">
    <div class="versions-header">
        <h3>Versioni</h3>
        <button class="btn-icon" onclick="toggleVersionsPanel()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
    </div>
    <div id="versions-list"></div>
</div>

<!-- ==================== DEPENDENCIES PANEL ==================== -->
<div id="deps-panel-backdrop" onclick="toggleDepsPanel()"></div>
<div id="deps-panel">
    <div class="deps-panel-header">
        <h3>Dipendenze</h3>
        <button class="btn-icon" onclick="toggleDepsPanel()" title="Chiudi">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
    </div>
    <div id="deps-panel-body"></div>
</div>

<!-- ==================== SETTINGS PANEL (generico) ==================== -->
<div id="settings-backdrop" onclick="closeSettingsPanel()"></div>
<div id="settings-panel">
    <div class="settings-panel-header">
        <h3 id="settings-panel-title"></h3>
        <button class="btn-icon" onclick="closeSettingsPanel()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
    </div>
    <div id="settings-panel-body"></div>
</div>

<!-- ==================== MODAL ==================== -->
<div id="modal-overlay" onclick="if(event.target===this)closeModal()">
    <div class="modal">
        <div class="modal-header">
            <h3 id="modal-title"></h3>
            <button class="btn-icon" onclick="closeModal()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <div id="modal-body"></div>
        <div id="modal-footer"></div>
    </div>
</div>

<!-- ==================== TOAST ==================== -->
<div id="toast-container"></div>

<!-- ==================== SCRIPTS ==================== -->
<script src="js/app.js"></script>
<script src="js/utils.js"></script>
<script src="js/dependencies.js"></script>
<script src="js/workspace.js"></script>
<script src="js/storage.js"></script>
<script src="js/gantt.js"></script>
<script src="js/gantt-global.js"></script>
<script src="js/drag.js"></script>
<script src="js/history.js"></script>
<script src="js/ui.js"></script>
<script src="js/exporter.js"></script>
<script src="js/actions.js"></script>
<script src="js/main.js"></script>

</body>
</html>
